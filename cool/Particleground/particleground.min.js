/**
 * particleground v1.0.0
 * https://github.com/Barrior/particleground
 * Copyright 2016 Barrior <Barrior@qq.com>
 * 采用 知识共享署名 3.0 中国大陆许可协议 进行许可。
 * 可自由转载、引用，但需保留作者及插件信息。
 * http://creativecommons.org/licenses/by/3.0/cn/
 */
!function(a,b){"function"==typeof define&&define.amd?define(b):"object"==typeof module&&module.exports?module.exports=b():a.Particleground=b()}(this,function(a,b){"use strict";function k(a){return parseInt(a,10)}function l(){return"#"+d().toString(16).slice(-6)}function m(a,b){return d()*(a-b)+b}function n(a,b){for(var c in b)a[c]=b[c];return a}function o(a,b){return k(getComputedStyle(a)[b])}function p(a,b,c){a.addEventListener(b,c)}function q(a,b,c){a.removeEventListener(b,c)}function r(b,c){var d=c.container=a.querySelector(b),e=c.c=a.createElement("canvas");c.cw=e.width=o(d,"width"),c.ch=e.height=o(d,"height"),d.appendChild(e),c.cxt=e.getContext("2d"),c.paused=!1}function s(a,b){a.paused||(a.paused=!0,b&&b.call(a))}function t(a,b){a.paused&&(b&&b.call(a),a.paused=!1,a.draw())}function u(a){!a.paused&&requestAnimationFrame(a.draw.bind(a))}var v,w,c=this,d=b.random,e=b.floor,f=b.abs,g=b.sin,h=b.PI,i=2*h,j=h/180;return c.requestAnimationFrame=function(a){return a.requestAnimationFrame||a.webkitRequestAnimationFrame||a.mozRequestAnimationFrame||function(b){a.setTimeout(b,1e3/60)}}(c),v={particle:function(a,b){var c=this.set=n({opacity:.8,color:[],speed:1,num:.1,max:2.4,min:.6,dis:180,lineWidth:.2,r:240,eventElem:!1},b);r(a,this),"object"!=typeof c.eventElem&&(c.eventElem=this.c),this.posX=d()*this.cw,this.posY=d()*this.ch,this.createDot(),this.draw(),this.event()},wave:function(a,b){this.set=n({opacity:.8,color:"#fff",num:1,max:1.4,min:.2,crest:.8,speed:1.4},b),r(a,this),this.createDot(),this.draw(),this.event()},snow:function(a,b){this.set=n({color:"#fff",max:6.5,min:.4,speed:.4},b),r(a,this),this.dot=[],this.createDot(),this.draw(),this.event()}},w={pause:function(){s(this)},open:function(){t(this)}},v.particle.prototype={createDot:function(){var n,a=this.cw,b=this.ch,c=this.set,f=c.speed,g=a*c.num,h=l,i=c.color.length,j=[],k=0;for(c.num>=1&&(g=c.num),i&&(h=function(){return c.color[e(d()*i)]});g>k;k++)n=m(c.max,c.min),j.push({x:m(a-n,n),y:m(b-n,n),r:n,vx:m(f,.5*-f)||f,vy:m(f,.5*-f)||f,color:h()});this.dot=j},draw:function(){var a=this.set,b=this.cw,c=this.ch,d=this.cxt;d.clearRect(0,0,b,c),d.lineWidth=a.lineWidth,d.globalAlpha=a.opacity,this.dot.forEach(function(a){var f,g,e=a.r;d.save(),d.beginPath(),d.arc(a.x,a.y,e,0,i),d.fillStyle=a.color,d.fill(),d.restore(),a.x+=a.vx,a.y+=a.vy,f=a.x,g=a.y,(f+e>=b||0>=f-e)&&(a.vx*=-1),(g+e>=c||0>=g-e)&&(a.vy*=-1)}),this.connectDot(),u(this)},connectDot:function(){var a=this.cxt,b=this.set,c=b.dis,d=this.posX,e=this.posY,g=b.r,h=[];this.dot.forEach(function(a){f(a.x-d)<=g&&f(a.y-e)<=g&&h.push(a)}),h.forEach(function(b){h.forEach(function(d){var e=b.x,g=b.y,h=d.x,i=d.y;f(e-h)<=c&&f(g-i)<=c&&(a.save(),a.beginPath(),a.moveTo(e,g),a.lineTo(h,i),a.strokeStyle=b.color,a.stroke(),a.restore())})})},event:function(){this.handler=function(a){this.posX=a.clientX,this.posY=a.clientY}.bind(this),p(this.c,"mousemove",this.handler),this.set.resize&&p(c,"resize",function(){var c,d,a=this.cw,b=this.ch;this.cw=this.c.width=o(this.container,"width"),this.ch=this.c.height=o(this.container,"height"),c=this.cw/a,d=this.ch/b,this.posX*=c,this.posY*=d,this.dot.forEach(function(a){a.x*=c,a.y*=d}),this.paused&&this.draw()}.bind(this))},pause:function(){s(this,function(){q(this.set.eventElem,"mousemove",this.handler)})},open:function(){t(this,function(){p(this.set.eventElem,"mousemove",this.handler)})}},v.wave.prototype={createDot:function(){var g,h,i,a=this.set,b=this.ch,c=1,d=this.cw/2,e=[],f=(a.max-a.min)/d;for(g=0;c>g;g++){for(h=[],i=0;d>i;i++)h.push({x:2*i,y:b/(30-27.6*i/d),angle:i,r:i*f+a.min});e.push(h)}this.dot=e},draw:function(){var a=this.set,b=this.cxt,c=this.cw,d=this.ch,e=d/2,f=a.speed;b.clearRect(0,0,c,d),b.globalAlpha=a.opacity,b.fillStyle=a.color,this.dot.forEach(function(a){a.forEach(function(a){b.save(),b.beginPath(),b.arc(a.x,a.y*g(a.angle*j)+e,a.r,0,i),b.fill(),b.restore(),a.angle-=f})}),u(this)},event:function(){this.set.resize&&p(c,"resize",function(){var c,d,a=this.cw,b=this.ch;this.cw=this.c.width=o(this.container,"width"),this.ch=this.c.height=o(this.container,"height"),c=this.cw/a,d=this.ch/b,this.dot.forEach(function(a){a.forEach(function(a){a.x*=c,a.y*=d})}),this.paused&&this.draw()}.bind(this))}},n(v.wave.prototype,w),v.snow.prototype={snowShape:function(){var a=this.set,b=m(a.max,a.min);return{x:d()*this.cw,y:-b,r:b,vx:d()||.4,vy:b*a.speed}},createDot:function(){var b,a=6*d();for(b=0;a>b;b++)this.dot.push(this.snowShape())},draw:function(){var a=this,b=a.set,c=a.cxt,e=a.cw,f=a.ch,g=a.dot;c.clearRect(0,0,e,f),c.fillStyle=b.color,g.forEach(function(b,h){c.save(),c.beginPath(),c.arc(b.x,b.y,b.r,0,i),c.fill(),c.restore(),b.x+=b.vx,b.y+=b.vy,d()>.99&&d()>.5&&(b.vx*=-1),b.x<0||b.x-b.r>e?(g.splice(h,1),g.push(a.snowShape())):b.y-b.r>=f&&g.splice(h,1)}),d()>.9&&a.createDot(),u(this)},event:function(){this.set.resize&&p(c,"resize",function(){var c,d,a=this.cw,b=this.ch;this.cw=this.c.width=o(this.container,"width"),this.ch=this.c.height=o(this.container,"height"),c=this.cw/a,d=this.ch/b,this.dot.forEach(function(a){a.x*=c,a.y*=d}),this.paused&&this.draw()}.bind(this))}},n(v.snow.prototype,w),v}.bind(this,document,Math));